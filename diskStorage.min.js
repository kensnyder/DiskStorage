/*
 * diskStorage.js: a Wrapper for localStorage
 * Copyright (c) 2010 Ken Snyder under the MIT license: http://www.opensource.org/licenses/mit-license.html
 */
(function(b){function k(){this.subscribers=[]}k.prototype.setItem=function d(l,m){if(this.subscribers.length>0){oldValue=this.getItem(l);this.notify(l,oldValue,m)}m=Object.prototype.toString.call(m)=="[object String]"?m:"\u0001"+JSON.stringify(m);b.localStorage.setItem("\u0002"+l,m);return this};k.prototype.getItem=function j(l){var m=b.localStorage.getItem("\u0002"+l,m);if(m&&m.charAt(0)=="\u0001"){m=JSON.parse(m.slice(1))}return m};k.prototype.removeItem=function i(l){if(this.subscribers.length>0){oldValue=this.getItem(l);this.notify(l,oldValue,undefined)}b.localStorage.removeItem("\u0002"+l);return this};k.prototype.clear=function e(){b.localStorage.clear();return this};k.prototype.getLength=function f(){return b.localStorage.length};k.prototype.subscribe=function c(l){this.subscribers.push(l);return this};k.prototype.unsubscribe=function g(o){var n=[],l=0,m;if(arguments.length>0){while((m=this.subscribers[l++])){if(m!==o){n.push(m)}}}this.subscribers=n;return this};k.prototype.notify=function h(n,l,p){var m=0,o;while((o=this.subscribers[m++])){o({timestamp:+new Date,target:this,key:n,oldValue:l,newValue:p,url:window.location.href})}return this};b.diskStorage=new k;b.diskStorage.isSupported=function a(){try{return"localStorage" in b&&!!b.localStorage&&JSON&&JSON.parse&&JSON.stringify}catch(l){return false}}})(this);